{% extends "base.html" %}

{% block title %}å€™é€‰äººç®¡ç† - BOSSæ‹›è˜åŠ©æ‰‹{% endblock %}

{% block content %}

<!-- Troubleshooting Modal -->
<div x-data="{ 
        showTroubleshooting: false,
        contentKey: 'candidates-troubleshooting',
        content: 'å¦‚æœå‡ºç°é—®é¢˜ï¼Œè¯·æŒ‰ç…§ä¸‹é¢æµç¨‹æ’æŸ¥ï¼š\n1. è¯·æŸ¥çœ‹bossé¡µé¢æ˜¯å¦æ­£å¸¸\n2. åˆ·æ–°é¡µé¢\n3. æŸ¥çœ‹ç»ˆç«¯ï¼ˆterminalï¼‰çš„æç¤ºï¼Œæ˜¯å¦æœ‰é”™è¯¯\n4. å¦‚ç»ˆç«¯æœ‰é”™è¯¯ï¼Œå¤åˆ¶ç»ˆç«¯é”™è¯¯å¹¶é—®é—®cursoræˆ–è€…å°è¯•ç”¨cursorä¿®å¤\n5. å°†cursorçš„å›ç­”å‘é€åˆ°ç¾¤é‡Œè®©å·¥ç¨‹å¸ˆä¿®å¤',
        init() {
            // Use hash-based notification system
            if (typeof window.shouldShowNotification === 'function') {
                this.showTroubleshooting = window.shouldShowNotification(this.contentKey, this.content);
            }
            if (this.showTroubleshooting) {
                this.$el.style.display = 'flex';
            }
        },
        dismiss() {
            if (typeof window.acknowledgeNotification === 'function') {
                window.acknowledgeNotification(this.contentKey, this.content);
            }
            this.showTroubleshooting = false;
        }
     }" 
     x-show="showTroubleshooting"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
     style="display: none;">
    <div class="bg-white rounded-lg shadow-2xl max-w-md w-full mx-4"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform scale-100"
         x-transition:leave-end="opacity-0 transform scale-95">
        <div class="p-6">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-3">
                    <span class="text-2xl">âš ï¸</span>
                </div>
                <h3 class="text-xl font-bold text-gray-800">é—®é¢˜æ’æŸ¥æç¤º</h3>
            </div>
            <div class="mb-6">
                <p class="text-gray-700 leading-relaxed whitespace-pre-line" x-text="content"></p>
            </div>
            <div class="flex justify-end">
                <button @click="dismiss()"
                        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                    å·²çŸ¥æ™“
                </button>
            </div>
        </div>
    </div>
</div>

<div x-data="candidateTabs()" x-init="init()" class="space-y-6">
    <!-- Page header with controls -->
    <div class="bg-white rounded-lg shadow p-6">
        <!-- <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">å€™é€‰äººç®¡ç†</h1>
            <button onclick="location.reload()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
                ğŸ”„ åˆ·æ–°
            </button>
        </div> -->
        
        <!-- Tab switcher with batch analyze button -->
        <div class="flex justify-between items-center border-b mb-4">
            <div class="flex space-x-2" id="tab-buttons">
            <button 
                @click="switchTab('recommend')"
                data-tab="recommend"
                :class="activeTab === 'recommend' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'"
                class="tab-btn px-4 py-3 font-medium hover:text-blue-600 transition">
                â­ æ¨èç‰›äºº
            </button>
            <button 
                @click="switchTab('greet')"
                data-tab="greet"
                :class="activeTab === 'greet' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'"
                class="tab-btn px-4 py-3 font-medium hover:text-blue-600 transition">
                ğŸ‘‹ æ–°æ‹›å‘¼
            </button>
            <button 
                @click="switchTab('chat')"
                data-tab="chat"
                :class="activeTab === 'chat' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'"
                class="tab-btn px-4 py-3 font-medium hover:text-blue-600 transition">
                ğŸ’¬ æ²Ÿé€šä¸­
            </button>
            <button 
                @click="switchTab('followup')"
                data-tab="followup"
                :class="activeTab === 'followup' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'"
                class="tab-btn px-4 py-3 font-medium hover:text-blue-600 transition">
                ğŸ“­ ç‰›äººå·²è¯»æœªå›
            </button>
            </div>
            <!-- Batch analyze button in top-right -->
            <button 
                id="batch-analyze-btn"
                onclick="if (typeof processAllCandidates === 'function') { processAllCandidates(); } else { showToast('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå€™é€‰äººä»¥åŠ è½½æ‰¹å¤„ç†åŠŸèƒ½', 'warning'); }"
                title="æ‰¹å¤„ç†å°†æŒ‰ä»¥ä¸‹æ­¥éª¤è‡ªåŠ¨å¤„ç†æ¯ä¸ªå€™é€‰äººï¼š&#10;1. åŠ è½½åœ¨çº¿ç®€å†ï¼ˆå¦‚æœªåŠ è½½ï¼‰&#10;2. åˆå§‹åŒ–å¯¹è¯ï¼ˆå¦‚æœªåˆå§‹åŒ–ï¼‰&#10;3. è¿›è¡ŒAIåˆ†æï¼ˆå¦‚æœªåˆ†æï¼‰&#10;4. æ ¹æ®åŒ¹é…åº¦é˜ˆå€¼ï¼š&#10;   - è¾¾åˆ°æ²Ÿé€šé˜ˆå€¼ï¼šç”Ÿæˆæ¶ˆæ¯&#10;   - è¾¾åˆ°åŠæ ¼çº¿ï¼šè·å–å®Œæ•´ç®€å†å¹¶é‡æ–°åˆ†æï¼ˆæ²Ÿé€šä¸­æ¨¡å¼ï¼‰æˆ–å‘é€æ‹›å‘¼ï¼ˆæ¨èæ¨¡å¼ï¼‰&#10;5. æ›´æ–°å€™é€‰äººå¡ç‰‡çŠ¶æ€"
                class="hidden px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed">
                å…¨éƒ¨åˆ†æ
            </button>
        </div>
        
        <!-- Filters -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">å²—ä½</label>
                <select id="job-selector" name="job_id" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                        hx-get="/jobs/list-simple" hx-trigger="load" hx-swap="innerHTML"
                        hx-on::after-swap="window.updateCandidateURL && window.updateCandidateURL()"
                        @change="updateURL()">
                    <option>åŠ è½½ä¸­...</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    æ²Ÿé€šé˜ˆå€¼
                    <span class="text-xs text-gray-500">â‰¥ æ­¤åˆ†æ•°ç”Ÿæˆæ¶ˆæ¯</span>
                </label>
                <div class="flex items-center gap-2">
                    <input type="number" id="threshold-chat" name="threshold_chat" 
                           value="5.0" 
                           min="1" max="10" step="0.5"
                           @change="updateURL()"
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <label class="flex items-center space-x-1 cursor-pointer whitespace-nowrap">
                        <input type="checkbox" id="auto-send-checkbox" checked class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="text-sm text-gray-700">è‡ªåŠ¨å‘é€</span>
                    </label>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                     åŠæ ¼çº¿
                    <span class="text-xs text-gray-500">â‰¥ æ­¤åˆ†æ•°è¡¨ç¤ºå…´è¶£</span>
                </label>
                <input type="number" id="threshold-borderline" name="threshold_borderline" 
                       value="7.0" 
                       min="1" max="10" step="0.5"
                       @change="updateURL()"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    å¼ºåŒ¹é…é˜ˆå€¼
                    <span class="text-xs text-gray-500">â‰¥ æ­¤åˆ†æ•°è¦æ±‚è”ç³»æ–¹å¼</span>
                </label>
                <input type="number" id="threshold-seek" name="threshold_seek" 
                       value="9.0" 
                       min="1" max="10" step="0.5"
                       @change="updateURL()"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
        </div>
    </div>
    
    <!-- Main content area: List + Detail -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Candidate list (left sidebar) -->
        <div class="lg:col-span-4">
            <div class="bg-white rounded-lg shadow-lg h-[1000px] overflow-y-auto">
                <div id="candidate-list" class="p-4 space-y-2">
                    <!-- Initial message -->
                    <div id="initial-message" class="text-center text-gray-500 py-12">
                        ç‚¹å‡»ä¸‹æ–¹"æŸ¥è¯¢å€™é€‰äºº"æŒ‰é’®åŠ è½½æ•°æ®
                    </div>
                    <!-- Candidates will be appended here -->
                </div>
                
                <!-- Load more button at bottom of list -->
                <div class="p-4 border-t bg-gray-50">
                    <div class="flex gap-2 items-end">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">æ•°é‡é™åˆ¶</label>
                            <input 
                                type="number" 
                                id="limit-input" 
                                name="limit" 
                                value="50" 
                                min="1" 
                                max="999" 
                                step="1"
                                @change="updateURL()"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    <button 
                        @click="loadCandidates()"
                        id="load-more-btn"
                        :disabled="loading"
                        :class="loading ? 'opacity-50 cursor-not-allowed' : ''"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        <span x-text="loading ? 'â³ åŠ è½½ä¸­...' : 'ğŸ” æŸ¥è¯¢å€™é€‰äºº'"></span>
                    </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Candidate detail (right panel) -->
        <div class="lg:col-span-8">
            <div id="detail-pane" class="bg-white rounded-lg shadow-lg p-6">
                <!-- Will be populated when candidate is selected -->
                <div class="text-center text-gray-500 py-24">
                    <div class="text-6xl mb-4">ğŸ‘¤</div>
                    <p class="text-lg">è¯·ä»å·¦ä¾§åˆ—è¡¨ä¸­é€‰æ‹©å€™é€‰äºº</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- All candidate logic is now handled by Alpine.js in app.js via candidateTabs() -->

<script>
// Candidate list page logic is now centralized in candidate_detail.html
</script>
{% endblock %}

